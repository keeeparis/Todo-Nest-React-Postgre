setup:
  addons:
    - plan: heroku-postgresql
    as: DATABASE
  config:
    POSTGRES_HOST: postgres_db
    POSTGRES_USER: postgres
    POSTGRES_DB: todoapp
    POSTGRES_PASSWORD: root
    POSTGRES_PORT: 5432
    
build:
  docker:
    client: ./client/Dockerfile
    server: ./server/Dockerfile
  config:
    NODE_ENV: production
    PORT: 5500
    POSTGRES_HOST: postgres_db
    POSTGRES_USER: postgres
    POSTGRES_DB: todoapp
    POSTGRES_PASSWORD: root
    POSTGRES_PORT: 5432
    PRIVATE_KEY: 'secret_key_1337'

release:
  image: server
  command:
    - npm run migration:run && npm run migration:seed
  config:
    NODE_ENV: production
    
run:
  server: node main.js